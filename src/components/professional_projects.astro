---
import { Image } from "astro:assets";
import ProjectCard from "@/components/project_card.astro";

import MCC from "../../public/halo_MCC.png";
import BelowAndBeyond from "../../public/surviving_mars.png";
import DungeonLogo from "../../public/endless_dungeon.png";
import Confidential from "../../public/unreleased_shooter.png";
import PortalSII from "../../public/portal_sii.png";

interface Project {
  title: string;
  image: ImageMetadata;
  id: string;
  preview: string;
  status: string;
  description: string;
  gallery: ImageMetadata[];
}

const projects: Project[] = [
  {
    title: "Halo: The Master Chief Collection",
    image: MCC as ImageMetadata,
    id: "halo_mcc",
    preview: "https://abstraction.games/game/halo-the-master-chief-collection",
    status: "abstraction games",
    description: "this is a test description",
    gallery: [
      MCC as ImageMetadata,
      MCC as ImageMetadata,
    ]
  },
  {
    title: "The Endless Dungeon",
    image: DungeonLogo as ImageMetadata,
    id: "endless_dungeon",
    preview: "https://youtu.be/MlQApTnDdLU",
    status: "abstraction games",
    description: "this is a test description",
    gallery: [
      MCC as ImageMetadata,
      MCC as ImageMetadata,
    ]
  },
  {
    title: "Surviving Mars: Below & Beyond",
    image: BelowAndBeyond as ImageMetadata,
    id: "suma",
    preview: "https://abstraction.games/game/survivingmars",
    status: "abstraction games",
    description: "this is a test description",
    gallery: [
      MCC as ImageMetadata,
      MCC as ImageMetadata,
    ]
  },
  {
    title: "Unreleased AAA first person shooter",
    image: Confidential as ImageMetadata,
    id: "aaa_fps",
    preview: "empty",
    status: "abstraction games",
    description: "this is a test description",
    gallery: [
      MCC as ImageMetadata,
      MCC as ImageMetadata,
    ]
  },
  {
    title: "Portal SII",
    image: PortalSII as ImageMetadata,
    id: "portal_sii",
    preview: "empty",
    status: "AHORA freeware",
    description: "this is a test description",
    gallery: [
      MCC as ImageMetadata,
      MCC as ImageMetadata,
    ]
  },
];
---

<section
  id="professional_projects"
  class="py-12 border-t border-[#ffffff10] text-[var(--white)]"
>
  <div class="max-w-5xl mx-auto">
    <h2 class="text-lg text-[var(--sec)] mb-2 shiny-sec">Work produced as part of a company</h2>
    <h3 class="text-4xl md:text-5xl font-medium mb-8">Industry Experience</h3> 

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {
        projects.map((project) => (
          <ProjectCard project={project} />
        ))
      }
    </div>

    <!-- Shared detail panel -->
    <div
      id="project-detail-panel"
      class="hidden bg-[#141414] border-t border-[#ffffff10] mt-8 py-10 px-6 md:px-12 rounded-2xl"
    >
      <div class="max-w-4xl mx-auto space-y-6">
        <!-- Content will be injected here via JS -->
      </div>
    </div>

  </div>

  <script type="application/json" id="projects-data">
    {JSON.stringify(projects)}
  </script>

</section>

<script>
  // Global state
  let activeProjectId = null;

  const projects = JSON.parse(document.getElementById('projects-data').textContent);

  // All project cards
  const cards = document.querySelectorAll('.project-card');
  const detailPanel = document.getElementById('project-detail-panel');
  const detailContent = detailPanel?.querySelector('div');

  // Toggle function
  (window as any).toggleProject = function(projectId, btn) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    // If clicking the already open project → close
    if (activeProjectId === projectId) {
      detailPanel.classList.add('hidden');
      activeProjectId = null;
      btn.classList.remove('rotate-180');
      return;
    }

    // Close any previously open
    detailPanel.classList.remove('hidden');

    // Update content
    detailContent.innerHTML = `
      <h4 class="text-3xl font-semibold mb-4">${project.title}</h4>
      <p class="text-lg text-gray-300 mb-6">${project.description}</p>

      ${project.gallery?.length ? `
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
          ${project.gallery.map(img => `
            <img src="${img}" alt="${project.title} screenshot" class="rounded-xl object-cover w-full h-64" />
          `).join('')}
        </div>
      ` : ''}

      ${project.link ? `
        <a href="${project.link}" target="_blank" class="inline-flex items-center gap-2 text-[var(--sec)] hover:underline">
          View on GitHub →
        </a>
      ` : ''}
    `;

    // Rotate button
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('rotate-180'));
    btn.classList.add('rotate-180');

    activeProjectId = projectId;

    // Smooth scroll to detail panel
    detailPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };
</script>
