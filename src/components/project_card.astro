---
import { Image } from "astro:assets";

const { project } = Astro.props;
---

<div class="group border border-[#ffffff10] rounded-2xl p-4 project-card">
  <!-- Preview Image -->
  <a
    href={project.preview}
    target="_blank"
    rel="noopener noreferrer"
    class="block rounded-2xl overflow-hidden shadow-lg mb-4 hover:shadow-xl transition-shadow duration-300"
  >
    <Image
      src={project.image}
      alt={project.title}
      class="w-full h-48 md:h-72 object-cover transition-transform duration-300 group-hover:scale-105"
    />
  </a>

  <!-- Header -->
  <div class="flex items-start gap-4">
    <div class="flex-grow">
      <h4 class="text-2xl font-semibold">{project.title}</h4>
      <span class="text-sm text-[var(--white-icon)]">{project.status}</span>
    </div>

    <!-- Toggle Button -->
    <button
      type="button"
      aria-label="View project details"
      class="size-14 flex justify-center items-center text-[var(--white-icon)] hover:text-white transition border border-[var(--white-icon-tr)] rounded-xl bg-[#1414149c] hover:bg-[var(--white-icon-tr)]"
      onclick={`window.toggleProject('${project.id}')`}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="size-7"
      >
        <path d="M24 12L18.3431 17.6569L16.9289 16.2426L21.1716 12L16.9289 7.75736L18.3431 6.34315L24 12ZM2.82843 12L7.07107 16.2426L5.65685 17.6569L0 12L5.65685 6.34315L7.07107 7.75736L2.82843 12ZM9.78845 21H7.66009L14.2116 3H16.3399L9.78845 21Z" />
      </svg>
    </button>
  </div>
</div>

<!-- Bottom row panel -->
<div
  id={`panel-${project.id}`}
  class="project-panel overflow-hidden max-h-0 transition-[max-height] duration-700 ease-in-out w-full flex justify-center"
>
  <div class="max-w-3xl text-center mt-6 p-6 rounded-2xl border border-[#ffffff10] bg-[#141414]">
    <h3 class="text-3xl font-semibold text-[var(--white)] mb-4">{project.title}</h3>
    <p class="text-[var(--white-icon)] mb-4">{project.description}</p>

    {project.gallery && project.gallery.length > 0 && (
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {project.gallery.map((img, idx) => (
          <Image
            src={img}
            alt={`${project.title} screenshot ${idx + 1}`}
            class="rounded-xl object-cover"
          />
        ))}
      </div>
    )}

    {project.link && (
      <a
        href={project.link}
        target="_blank"
        rel="noopener noreferrer"
        class="mt-4 inline-flex items-center justify-center p-3 rounded-xl border border-[var(--white-icon-tr)] bg-[#1414149c] hover:bg-[var(--white-icon-tr)] text-[var(--white-icon)] transition"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-7"
        >
          <path d="M24 12L18.3431 17.6569L16.9289 16.2426L21.1716 12L16.9289 7.75736L18.3431 6.34315L24 12ZM2.82843 12L7.07107 16.2426L5.65685 17.6569L0 12L5.65685 6.34315L7.07107 7.75736L2.82843 12ZM9.78845 21H7.66009L14.2116 3H16.3399L9.78845 21Z" />
        </svg>
      </a>
    )}
  </div>
</div>

<script>
  (window as any).toggleProject = function(id, btn) {
    // NodeLists
    const allPanels = document.querySelectorAll(".project-details");
    const allButtons = document.querySelectorAll(".toggle-btn");

    // Target panel
    const target = document.getElementById(`project-${id}`);
    if (!target) return;

    const targetEl = /** @type {HTMLElement} */ (target);

    const isOpen =
      targetEl.style.maxHeight && targetEl.style.maxHeight !== "0px";

    // Close all panels
    allPanels.forEach((panel) => {
      const panelEl = panel as HTMLElement; // <-- CAST HERE
      panelEl.style.maxHeight = "0px";
    });

    // Reset all buttons
    allButtons.forEach((button) => {
      const btnEl = button as HTMLElement; // <-- CAST HERE
      btnEl.classList.remove("rotate-180");
    });

    // Open the clicked panel if it was closed
    if (!isOpen) {
      targetEl.style.maxHeight = targetEl.scrollHeight + "px";
      btn.classList.add("rotate-180");
    }
  }
  </script>